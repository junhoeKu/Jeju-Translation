<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>Ï†úÏ£ºÏùò Ïñ∏Ïñ¥ Îã§Î¶¨</title>
<style>
body {
    font-family: 'Noto Sans KR', sans-serif;
    background-color: #ffffff;
    margin: 0;
    padding: 0;
}

#header {
    display: flex;
    align-items: center;
    padding: 10px 20px;
    background-color: #ffffff;
    border-bottom: 1px solid #e6e6e6;
}

#header img {
    height: 30px;
    margin-right: 20px;
}

#header a {
    margin-right: 20px;
    color: #333;
    text-decoration: none;
    font-size: 18px;
}

#header a:hover {
    text-decoration: underline;
}

#translate-section {
    display: flex;
    justify-content: center;
    margin: 40px 0;
}

.translate-box {
    background-color: #f9f9f9;
    border: 1px solid #e6e6e6;
    border-radius: 10px;
    width: 45%;
    padding: 20px;
    margin: 0 10px;
    box-sizing: border-box;
    position: relative;
}

.translate-box::before {
    content: "";
    background-size: cover;
    opacity: 0.1;
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 1;
    border-radius: 10px;
}

.translate-box select, .translate-box textarea {
    position: relative;
    z-index: 2;
    background-color: rgba(255, 255, 255, 0.9);
}

.translate-box textarea {
    width: 100%;
    height: 150px;
    border: none;
    resize: none;
    outline: none;
    padding: 10px;
    box-sizing: border-box;
    font-size: 16px;
    border-radius: 10px;
    background-color: #fff;
    border: 1px solid #e6e6e6;
}

.translate-box textarea:focus {
    border-color: #cccccc;
}

.translate-box select {
    width: 100%;
    border: none;
    outline: none;
    padding: 10px;
    font-size: 16px;
    border-radius: 10px;
    margin-bottom: 10px;
    background-color: #fff;
    border: 1px solid #e6e6e6;
}

.translate-box .bottom-section {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.translate-box .bottom-section button {
    border: none;
    background-color: #fd9f28;
    color: white;
    padding: 10px 20px;
    border-radius: 5px;
    cursor: pointer;
    font-size: 14px;
}

.translate-box .bottom-section button:hover {
    background-color: #e47200;
}

.translate-box .bottom-section .icons {
    display: flex;
    align-items: center;
}

.translate-box .bottom-section .icons button {
    margin-right: 10px;
    cursor: pointer;
    background: none;
    border: none;
    color: #fd9f28;
    font-size: 16px;
    padding: 5px;
    border-radius: 5px;
}

.translate-box .bottom-section .icons button:hover {
    opacity: 0.7;
}
</style>
</head>
<body>
    <div id="header">
        <img src="../static/img/BITAMIN.png" alt="Bitamin Logo">
        <a href="#">ÏõπÏÇ¨Ïù¥Ìä∏ Î≤àÏó≠</a>
        <a href="#">Î¨∏ÏÑú Î≤àÏó≠</a>
        <a href="#">ÏÇ¨Ï†Ñ</a>
    </div>

    <div id="translate-section">
        <div class="translate-box">
            <select id="sourceLanguage" onchange="setupOutputLanguage()">
                <option value="ÌëúÏ§Ä">ÌëúÏ§ÄÏñ¥</option>
                <option value="Ï†úÏ£º">Ï†úÏ£ºÏñ¥</option>
            </select>
            <textarea id="inputText" placeholder="Î≤àÏó≠Ìï† ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî."></textarea>
            <div class="bottom-section">
                <div class="icons">
                    <button onclick="playTextToSpeech('inputText')">üîä</button>
                    <button onclick="copyText('inputText')">üìã</button>
                </div>
                <button onclick="translateText()">Î≤àÏó≠ÌïòÍ∏∞</button>
            </div>
        </div>

        <div class="translate-box">
            <select id="outputLanguage">
                <option value="Ï†úÏ£º">Ï†úÏ£ºÏñ¥</option>
                <option value="ÌëúÏ§Ä">ÌëúÏ§ÄÏñ¥</option>
            </select>
            <textarea id="translationResult" placeholder="Î≤àÏó≠ Í≤∞Í≥ºÎ•º Ï∂úÎ†•Ìï©ÎãàÎã§." readonly></textarea>
            <div class="bottom-section">
                <div class="icons">
                    <button id="playTranslatedSpeech">üîä</button>
                    <button onclick="copyText('translationResult')">üìã</button>
                </div>
                <button onclick="shareText()">Í≥µÏú†ÌïòÍ∏∞</button>
            </div>
        </div>
    </div>

    <script>
        // JavaScript ÏΩîÎìú Ïú†ÏßÄ Î∞è ÏàòÏ†ï

        function setupOutputLanguage() {
            const inputLang = document.getElementById('sourceLanguage').value;
            const outputLang = document.getElementById('outputLanguage');

            if (inputLang === 'ÌëúÏ§Ä') {
                outputLang.value = 'Ï†úÏ£º';
            } else if (inputLang === 'Ï†úÏ£º') {
                outputLang.value = 'ÌëúÏ§Ä';
            }
        }

        async function translateText() {
            setupOutputLanguage(); // Ìò∏Ï∂úÌïòÏó¨ Ï¥àÍ∏∞ ÏÑ§Ï†ï

            let inputText = document.getElementById('inputText').value;
            const sourceLanguage = document.getElementById('sourceLanguage').value;
            const outputLanguage = document.getElementById('outputLanguage').value;

            // ÏóîÌÑ∞Î•º Ïò®Ï†êÏúºÎ°ú Î≥ÄÍ≤Ω
            inputText = inputText.replace(/\n/g, '. ');

            console.log('Input Text:', inputText);
            console.log('Source Language:', sourceLanguage);
            console.log('Output Language:', outputLanguage);

            try {
                const response = await fetch('http://143.198.93.184:5000/translate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ text: inputText, source_language: sourceLanguage })
                });

                const responseData = await response.json();
                console.log('Response Data:', responseData);

                if (responseData.translated_text) {
                    const translated_text = responseData.translated_text.replace(/\.\s/g, '\n');
                    document.getElementById('translationResult').value = translated_text;

                    // Î∞úÏùåÎì£Í∏∞ Î≤ÑÌäº ÌÅ¥Î¶≠ Ïãú ÏùåÏÑ± Ïû¨ÏÉù
                    document.getElementById('playTranslatedSpeech').onclick = () => {
                        playTextToSpeech('translationResult');
                    };
                } else {
                    document.getElementById('translationResult').innerText = 'Translation error: ' + (responseData.error || 'Unknown error');
                }
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('translationResult').innerText = 'Error: ' + error.message;
            }
        }

        function playTextToSpeech(elementId) {
            console.log("Î∞úÏùåÎì£Í∏∞");
            const text = document.getElementById(elementId).value;
            const sourceLanguage = document.getElementById('sourceLanguage').value;

            fetch('http://143.198.93.184:5000/text-to-speech', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ text: text, source_language: sourceLanguage }),
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.blob();
            })
            .then(audioBlob => {
                const audioUrl = URL.createObjectURL(audioBlob);
                const audio = new Audio(audioUrl);
                audio.play();
            })
            .catch((error) => {
                console.error('Error:', error);
            });
        }

        function base64ToBlob(base64) {
            const byteCharacters = atob(base64);
            const byteNumbers = new Array(byteCharacters.length);
            for (let i = 0; i < byteCharacters.length; i++) {
                byteNumbers[i] = byteCharacters.charCodeAt(i);
            }
            const byteArray = new Uint8Array(byteNumbers);
            return new Blob([byteArray], { type: 'audio/wav' });
        }

        function copyText(elementId) {
            console.log('Copy Text:', document.getElementById(elementId).value);
            const text = document.getElementById(elementId).value;
            navigator.clipboard.writeText(text).then(() => {
                console.log('Text copied to clipboard');
            }).catch(err => {
                console.error('Could not copy text: ', err);
            });
        }

        function bookmarkText() {
            console.log('Bookmark Text');
            // Add functionality to bookmark the text if required
        }

        function shareText() {
            console.log('Share Text');
            // Add functionality to share the text if required
        }
    </script>
</body>
</html>
